
# ✅ 1
CREATE TABLE IF NOT EXISTS app_users (
    id UUID PRIMARY KEY REFERENCES auth.users(id),
    full_name TEXT,
    avatar_url TEXT,
    email TEXT,

    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
# ✅ 2
CREATE TABLE IF NOT EXISTS user_profile (
    user_id UUID PRIMARY KEY REFERENCES app_users(id),

    height_cm INTEGER,
    weight_kg INTEGER,
    birthday DATE,
    sex TEXT CHECK (sex IN ('male', 'female', 'other')),

    fitness_level TEXT CHECK (fitness_level IN ('beginner', 'intermediate', 'advanced')),
    goal TEXT CHECK (goal IN ('lose_fat', 'build_muscle', 'general_fitness')),

    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
# ✅ 3
CREATE TABLE IF NOT EXISTS user_app_config (
    user_id UUID PRIMARY KEY REFERENCES app_users(id),
    preferences JSONB DEFAULT '{}', -- is_dark_mode, is_notification_enabled, metric_system, etc
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
# ✅ 4
CREATE TABLE IF NOT EXISTS user_trainer_config (
    user_id UUID PRIMARY KEY REFERENCES app_users(id),
    trainer_config JSONB DEFAULT '{}', -- 
    -- voice_id, selected voice preset for Rep
    -- voice_provider 
    -- language, primary language for TTS output
    -- persona_style, overall personality style (chill, standard, locked-in)
    -- age_cat (1,2,3,4,5)
    -- gender (male, female)
    -- enthusiasm_cat {1,2,3,4,5}
    -- speaking_rate {0.5 - 2}
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
# ✅ 5
CREATE TABLE IF NOT EXISTS workout_packages (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    title TEXT NOT NULL,
    description TEXT,
    category TEXT,
    estimated_duration_sec INTEGER,
    cover_image_url TEXT,

    user_id UUID REFERENCES app_users(id) DEFAULT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
    
    -- List of associated workout steps (array of workout_steps)
    steps JSONB DEFAULT '[]',
    -- Sample: 
    -- [
    --   {
    --     "step_id": "farmers-walk-uuid",
    --     "distance_m": 40,
    --     "weight_kg": 20
    --   },
    --
    --   {
    --     "step_id": "weighted-plank-uuid",
    --     "duration_s": 40,
    --     "weight_kg": 20
    --   },
    --
    --   {
    --     "step_id": "deadlift-uuid",
    --     "sets": [
    --       { "reps": 5, "weight_kg": 100 },
    --       { "reps": 5, "weight_kg": 110 }
    --     ],
    --     "rest_between_sets_s": 30
    --   }
    -- ]

);
# ✅ 6
CREATE TABLE IF NOT EXISTS workout_steps (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    
    title TEXT NOT NULL,
    description TEXT,
    estimated_duration_sec INTEGER,
    category TEXT,
    media_url TEXT,
    instructions TEXT,

    exercise_type TEXT CHECK (
        exercise_type IN ('reps', 'duration', 'weight', 'distance', 'custom')
    ), -- Helps with UI component render

    -- optional defaults ONLY
    default_reps INTEGER,
    default_duration_sec INTEGER,
    default_weight_kg FLOAT,
    default_distance_m FLOAT,

    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
# ✅ 7
CREATE TABLE IF NOT EXISTS user_workout_sessions (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID REFERENCES app_users(id),
    package_id UUID REFERENCES workout_packages(id),

    started_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    ended_at TIMESTAMP WITH TIME_ZONE,
    metadata JSONB DEFAULT '{}',

    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

// OPTIONAL

CREATE TABLE IF NOT EXISTS user_session_steps (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    session_id UUID REFERENCES user_workout_sessions(id),
    step_id UUID REFERENCES workout_steps(id),

    started_at TIMESTAMP WITH TIME ZONE,
    ended_at TIMESTAMP WITH TIME ZONE,
    duration_sec INTEGER,
    metrics JSONB DEFAULT '{}',

    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE TABLE IF NOT EXISTS user_metrics (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID REFERENCES app_users(id),

    metric_type TEXT NOT NULL,   -- weight, body_fat, etc
    value NUMERIC NOT NULL,
    logged_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),

    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
